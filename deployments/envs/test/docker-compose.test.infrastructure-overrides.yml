# ============================================
# isA Platform - Test Environment Overrides (Infrastructure)
# ============================================
# Port and naming overrides for infrastructure services

services:
  # ============== Infrastructure ==============

  consul:
    container_name: isa-consul-test
    ports:
      - "18500:8500"
      - "18600:8600/udp"
    environment:
      - ENVIRONMENT=test

  nats-1:
    container_name: isa-cloud-nats-1-test
    ports:
      - "14222:4222"
      - "16222:6222"
      - "18222:8222"
    environment:
      - ENVIRONMENT=test

  nats-2:
    container_name: isa-cloud-nats-2-test
    ports:
      - "14223:4222"
      - "16223:6222"
      - "18223:8222"
    environment:
      - ENVIRONMENT=test

  nats-3:
    container_name: isa-cloud-nats-3-test
    ports:
      - "14224:4222"
      - "16224:6222"
      - "18224:8222"
    environment:
      - ENVIRONMENT=test

  # ============== Data Stores ==============

  postgres:
    container_name: isa-postgres-test
    ports:
      - "15432:5432"
    environment:
      - ENVIRONMENT=test

  redis:
    container_name: isa-redis-test
    ports:
      - "16379:6379"
    environment:
      - ENVIRONMENT=test

  minio:
    container_name: isa-minio-test
    ports:
      - "19000:9000"
      - "19001:9001"
    environment:
      - ENVIRONMENT=test

  neo4j:
    container_name: isa-neo4j-test
    ports:
      - "17474:7474"
      - "17687:7687"
    environment:
      - ENVIRONMENT=test

  influxdb:
    container_name: isa-influxdb-test
    ports:
      - "18086:8086"
    environment:
      - ENVIRONMENT=test

  mosquitto:
    container_name: isa-mosquitto-test
    ports:
      - "11883:1883"
      - "19002:9001"
    environment:
      - ENVIRONMENT=test

  # ============== Supabase Services ==============

  supabase-kong:
    container_name: isa-supabase-kong-test
    ports:
      - "${SUPABASE_KONG_HTTP_PORT:-15432}:8000"
      - "${SUPABASE_KONG_HTTPS_PORT:-15433}:8443"
    environment:
      - ENVIRONMENT=test

  supabase-auth:
    container_name: isa-supabase-auth-test
    environment:
      - ENVIRONMENT=test
      - GOTRUE_DB_DATABASE_URL=postgres://supabase_auth_admin:${POSTGRES_PASSWORD:-postgres}@isa-postgres-test:5432/isa_platform

  supabase-rest:
    container_name: isa-supabase-rest-test
    environment:
      - ENVIRONMENT=test
      - PGRST_DB_URI=postgres://authenticator:${POSTGRES_PASSWORD:-postgres}@isa-postgres-test:5432/isa_platform
      - PGRST_DB_SCHEMAS=public,auth,storage,graphql_public

  supabase-realtime:
    container_name: isa-supabase-realtime-test
    environment:
      - ENVIRONMENT=test
      - DB_HOST=isa-postgres-test
      - DB_NAME=isa_platform

  supabase-storage:
    container_name: isa-supabase-storage-test
    environment:
      - ENVIRONMENT=test
      - DATABASE_URL=postgres://supabase_storage_admin:${POSTGRES_PASSWORD:-postgres}@isa-postgres-test:5432/isa_platform

  supabase-imgproxy:
    container_name: isa-supabase-imgproxy-test
    environment:
      - ENVIRONMENT=test

  supabase-meta:
    container_name: isa-supabase-meta-test
    environment:
      - ENVIRONMENT=test
      - PG_META_DB_HOST=isa-postgres-test

  supabase-studio:
    container_name: isa-supabase-studio-test
    ports:
      - "13323:3000"
    environment:
      - ENVIRONMENT=test

  # ============== Observability ==============

  loki:
    container_name: isa-loki-test
    ports:
      - "13100:3100"
    environment:
      - ENVIRONMENT=test

  grafana:
    container_name: isa-grafana-test
    ports:
      - "13003:3000"
    environment:
      - ENVIRONMENT=test

  promtail:
    container_name: isa-promtail-test
    environment:
      - ENVIRONMENT=test
