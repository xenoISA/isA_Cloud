# Patched Supabase GoTrue with migration bug fix
FROM public.ecr.aws/supabase/gotrue:v2.176.1

USER root

# Fix the uuid = text comparison bug in migration 20221208132122
RUN sed -i 's/id = user_id::text/id = user_id/g' \
    /usr/local/etc/auth/migrations/20221208132122_backfill_email_last_sign_in_at.up.sql

# Verify the patch
RUN grep "id = user_id" /usr/local/etc/auth/migrations/20221208132122_backfill_email_last_sign_in_at.up.sql

# Don't switch user - let docker-compose handle it
