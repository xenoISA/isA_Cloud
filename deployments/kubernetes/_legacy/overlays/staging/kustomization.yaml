apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: isa-cloud-staging

# 引用基础配置
resources:
  - ../../base/infrastructure
  - ../../base/applications

# 通用标签
commonLabels:
  environment: staging
  managed-by: kustomize

# 镜像替换（CI 会自动更新这里）
images:
  # 外部服务（从其他仓库构建）
  - name: agent
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-agent
    newTag: latest
  - name: mcp
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-mcp
    newTag: latest
  - name: model
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-model
    newTag: latest
  - name: user
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-user
    newTag: latest

# 资源配置补丁（staging 环境使用中等资源）
patchesStrategicMerge:
  - patches/resources-staging.yaml
  - patches/replicas-staging.yaml

# ConfigMap
configMapGenerator:
  - name: global-config
    literals:
      - ENVIRONMENT=staging
      - LOG_LEVEL=info
      - CONSUL_ADDR=consul.isa-cloud-staging.svc.cluster.local:8500
      - REDIS_ADDR=redis.isa-cloud-staging.svc.cluster.local:6379
      - POSTGRES_HOST=postgres.isa-cloud-staging.svc.cluster.local
