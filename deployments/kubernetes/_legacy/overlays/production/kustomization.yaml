# ============================================================================
# DEPRECATED - DO NOT USE FOR NEW DEPLOYMENTS
# ============================================================================
# This configuration is kept for historical reference only.
# For current configurations, see: deployments/kubernetes/{local,staging,production}/
# Deprecated as of: February 2025
# ============================================================================

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: isa-cloud-production

# 引用基础配置
resources:
  - ../../base/infrastructure
  - ../../base/applications
  # 生产环境额外资源
  - hpa.yaml  # Horizontal Pod Autoscaler
  - pdb.yaml  # Pod Disruption Budget

# 通用标签
commonLabels:
  environment: production
  managed-by: kustomize

# 镜像替换（CI 会自动更新这里）
images:
  # 外部服务（从其他仓库构建）
  - name: agent
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-agent
    newTag: v1.0.0  # 生产环境使用固定版本号
  - name: mcp
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-mcp
    newTag: v1.0.0
  - name: model
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-model
    newTag: v1.0.0
  - name: user
    newName: 123456789.dkr.ecr.us-east-1.amazonaws.com/isa-user
    newTag: v1.0.0

# 资源配置补丁（生产环境使用充足资源）
patchesStrategicMerge:
  - patches/resources-production.yaml
  - patches/replicas-production.yaml
  - patches/affinity.yaml  # Pod 反亲和性，确保分布在不同节点

# ConfigMap
configMapGenerator:
  - name: global-config
    literals:
      - ENVIRONMENT=production
      - LOG_LEVEL=warn
      - CONSUL_ADDR=consul.isa-cloud-production.svc.cluster.local:8500
      - REDIS_ADDR=redis.isa-cloud-production.svc.cluster.local:6379
      - POSTGRES_HOST=postgres.isa-cloud-production.svc.cluster.local
