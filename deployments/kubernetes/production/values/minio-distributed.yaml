# MinIO Distributed - Official Chart Values
# Chart: minio/minio
# Docs: https://github.com/minio/minio/tree/master/helm/minio

# Deployment mode
mode: distributed

# Distributed configuration
replicas: 4
drivesPerNode: 1
pools: 1

# Image
image:
  repository: quay.io/minio/minio
  tag: "RELEASE.2024-10-02T17-50-41Z"
  pullPolicy: IfNotPresent

# Root credentials (set via --set or external secret)
rootUser: ""                      # Set via --set rootUser=xxx
rootPassword: ""                  # Set via --set rootPassword=xxx

# Existing secret (alternative to rootUser/rootPassword)
# existingSecret: minio-credentials

# Resources
resources:
  requests:
    cpu: "1000m"
    memory: "2Gi"
  limits:
    cpu: "2000m"
    memory: "4Gi"

# Persistence
persistence:
  enabled: true
  storageClass: "infotrend-block"
  size: 200Gi
  accessMode: ReadWriteOnce

# Service configuration
service:
  type: ClusterIP
  port: 9000

consoleService:
  type: ClusterIP
  port: 9001

# Pod anti-affinity
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchLabels:
            app: minio
        topologyKey: kubernetes.io/hostname

# Topology spread
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app: minio

# Environment variables
environment:
  MINIO_BROWSER: "on"
  MINIO_PROMETHEUS_AUTH_TYPE: "public"
  MINIO_STORAGE_CLASS_STANDARD: "EC:2"
  # MINIO_IDENTITY_OPENID_CONFIG_URL: ""  # For OIDC auth

# MinIO configuration
configPathmc: "/tmp/minio/config"

# Buckets to create on startup
buckets:
  - name: isa-data
    policy: none
    purge: false
  - name: isa-backups
    policy: none
    purge: false
  - name: isa-logs
    policy: none
    purge: false
  - name: isa-models
    policy: none
    purge: false

# Policies (optional)
policies: []

# Users (optional - set via secrets in production)
users: []

# Service Account
serviceAccount:
  create: true
  name: "minio"

# Security context
securityContext:
  enabled: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

containerSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true

# Metrics
metrics:
  serviceMonitor:
    enabled: true
    namespace: isa-cloud-production
    labels:
      release: prometheus
    interval: 30s
    scrapeTimeout: 10s

# Network Policy
networkPolicy:
  enabled: true
  allowExternal: false

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 3

# Probes
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 15
  timeoutSeconds: 10
  failureThreshold: 3

startupProbe:
  enabled: true
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 60

# Post-install hooks for bucket policies
postJob:
  podSecurityContext:
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  securityContext:
    runAsUser: 1000
    runAsGroup: 1000
    runAsNonRoot: true

# Ingress (optional - configure if external access needed)
ingress:
  enabled: false
  # annotations:
  #   kubernetes.io/ingress.class: nginx
  #   cert-manager.io/cluster-issuer: letsencrypt
  # hosts:
  #   - host: minio.example.com
  #     paths:
  #       - path: /
  #         pathType: Prefix
  # tls:
  #   - secretName: minio-tls
  #     hosts:
  #       - minio.example.com

consoleIngress:
  enabled: false
